%% control_Hamiltonian.m
%
% Description:
%   Wrapper function for autogen_control_hamiltonian.m.
%   Computes the control Hamiltonian H, given robot state x, costate
%   lambda, and control input u.
%
% Inputs:
%   x: robot state vector, x = [x_cart; theta_pend; dx_cart; dtheta_pend];
%   lambda: costate vector, lambda = [lambda1; lambda2; lambda3; lambda4];
%   u: control input (scalar, horizontal force applied to the cart)
%   params: a struct with many elements, generated by calling init_params.m
%
% Outputs:
%   H: (scalar) value of the control Hamiltonian

function H = control_Hamiltonian(x,lambda,u,params)

    % break up state "x" into generalized coordinates and velocities:
    x_cart      = x(1);
    theta_pend  = x(2);
    dx_cart     = x(3);
    dtheta_pend = x(4);

    H = autogen_control_hamiltonian(params.model.dyn.pend.I,...
                                    params.control.swingup.TPBVP.Q(1,1),...
                                    params.control.swingup.TPBVP.Q(1,2),...
                                    params.control.swingup.TPBVP.Q(1,3),...
                                    params.control.swingup.TPBVP.Q(1,4),...
                                    params.control.swingup.TPBVP.Q(2,1),...
                                    params.control.swingup.TPBVP.Q(2,2),...
                                    params.control.swingup.TPBVP.Q(2,3),...
                                    params.control.swingup.TPBVP.Q(2,4),...
                                    params.control.swingup.TPBVP.Q(3,1),...
                                    params.control.swingup.TPBVP.Q(3,2),...
                                    params.control.swingup.TPBVP.Q(3,3),...
                                    params.control.swingup.TPBVP.Q(3,4),...
                                    params.control.swingup.TPBVP.Q(4,1),...
                                    params.control.swingup.TPBVP.Q(4,2),...
                                    params.control.swingup.TPBVP.Q(4,3),...
                                    params.control.swingup.TPBVP.Q(4,4),...
                                    params.control.swingup.TPBVP.R,...
                                    params.model.dyn.b1,...
                                    params.model.dyn.b2,...
                                    dtheta_pend,...
                                    dx_cart,...
                                    params.model.dyn.g,...
                                    lambda(1),...
                                    lambda(2),...
                                    lambda(3),...
                                    lambda(4),...
                                    params.model.dyn.cart.m,...
                                    params.model.dyn.pend.m,...
                                    params.model.dyn.pend.r_com,...
                                    theta_pend,...
                                    u,...
                                    x_cart);

end